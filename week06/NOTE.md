# 浏览器工作原来之 CSS 解析

## 收集 CSS rules

css 规则收集要在创建dom树之前，遇到`style`标签要把css规则保存起来;遇到`link`标签,判断`rel`属性正确后请求网络资源下载 css 文件,然后保存 css 规则。然后解析收集的 css rules,生成 ast
> css代码不要写在body中,这样会造成重新计算 css
> 性能消耗(越小越好): 重新计算 css > 重排 > 重绘

## 添加调用

每创建一个 dom 时,就需要计算当前 dom 对应的 css,理论上,当分析一个 dom 时,所有的 css rules 已经收集完毕.如果把 css rules 写在 body 标签中,则需要重新计算之前dom的 css

## 获取父元素序列

元素匹配 css rules 一定是由内向外.一定是先找到当前元素,然后再找父元素,所以我们必须知道当前元素的所有父元素才能判断元素与规则是否匹配
> `div div #myid`, 一定是先找到 id 为 myid 的元素,然后再去判断他是否有父 div 元素,最后判断是否有爷 div 元素,如果中间一个环节出错,则当前规则不匹配
>
> 题外话: select level 4 中的一些选择器因为性能问题浏览器厂商可能不会去实现

## 拆分选择器
